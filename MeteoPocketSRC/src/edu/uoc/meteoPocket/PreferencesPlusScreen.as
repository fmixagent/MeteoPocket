package edu.uoc.meteoPocket{	import edu.uoc.meteoPocket.PrefEvent;	import edu.uoc.meteoPocket.Screen;	import edu.uoc.meteoPocket.ScreenTypes;	import edu.uoc.meteoPocket.WeatherLookForWoeidEvent;		import flash.display.MovieClip;	import flash.display.SimpleButton;	import flash.display.Sprite;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.text.TextField;
		public class PreferencesPlusScreen extends Screen	{		private const MARGIN:int = 30;				//		private var _city:String;		private var _woeid:String;				private var scale:Number;				// Elements a la timeline		public var city_staticField:StaticField;		public var woeid_staticField:StaticField;		public var lookForCity_inputField:InputField;		public var background_sp:Sprite;		public var guardar_bt:SimpleButton;		public var cancelar_bt:SimpleButton;		public var cercar_bt:SimpleButton;		public var preloader_sp:MovieClip;				public function PreferencesPlusScreen(city:String,woeid:String)		{			super();						_city = city;			_woeid = woeid;		}				protected override function init(ev:Event):void		{			preloaderOFF();						super.init(ev);						// Initialise inputFields			city_staticField.setLabel("Ciutat actual");			woeid_staticField.setLabel("WOEID actual");							city_staticField.setData(_city);			woeid_staticField.setData(_woeid);						lookForCity_inputField.init("Cercar ciutat:","Introduïu nova ciutat")						//EVentlisteners			btGuardarOFF();			cancelar_bt.addEventListener(MouseEvent.CLICK,onCancelar);			cercar_bt.addEventListener(MouseEvent.CLICK,onCercar);		}				// EVENTLISTENERS		private function onGuardar(ev:MouseEvent):void {			trace("guardar");			var newWoeid:String = woeid_staticField.getInput();			var e:PrefEvent;			if( newWoeid != _woeid){				_woeid = newWoeid;				e = new PrefEvent(PrefEvent.CLOSE_PREF,false,false,_woeid);			} else {				e = new PrefEvent(PrefEvent.CLOSE_PREF,false,false,"");			}			dispatchEvent(e);					}		private function onCancelar(ev:MouseEvent):void {			trace("cancelar");			var e:PrefEvent = new PrefEvent(PrefEvent.CLOSE_PREF);			dispatchEvent(e);		}				private function onCercar(ev:MouseEvent):void {			var _cityInput:String = lookForCity_inputField.getInput();			lookForCity_inputField.setInput(capitalize(_cityInput));			if(  _cityInput == "" || _cityInput == "Introduiu nova ciutat"){				//No new city introduced				trace("INTRODUCE A CITY");			} else			{				trace("LOOK FOR WOEID");				var woeidRequest:WeatherCityToWoeidRequest;				woeidRequest = new WeatherCityToWoeidRequest(_cityInput);				woeidRequest.addEventListener(WeatherLookForWoeidEvent.COMPLETE, onWoeidLoaded)				loadingData(); //this is just visual, the loading is done by WeatherCityToWoeidRequest			}		}				private function onWoeidLoaded(ev:WeatherLookForWoeidEvent):void{			trace("THE WOEID FOR " + ev.cities[0].name + " is " + ev.cities[0].woeid);			city_staticField.setData(capitalize(ev.cities[0].name));			woeid_staticField.setData(ev.cities[0].woeid);			btGuardarON();			loadingDataComplete();		}				private function capitalize(str:String):String { 			str.toLowerCase();			// from Arno van Oordt stackoverflow :)			return str.replace(/(^[a-z]|\s[a-z])/g, function():String { return arguments[1].toUpperCase(); } 			); 		}				private function btGuardarON():void{			guardar_bt.alpha = 1;			guardar_bt.enabled = true;			guardar_bt.addEventListener(MouseEvent.CLICK,onGuardar);		}				private function btGuardarOFF():void{			guardar_bt.alpha = 0.2;			guardar_bt.enabled = false;			guardar_bt.removeEventListener(MouseEvent.CLICK,onGuardar);		}				private function preloaderOFF():void{			preloader_sp.visible = false;			preloader_sp.gotoAndStop(1);		}				private function preloaderON():void{			preloader_sp.gotoAndPlay(1);			preloader_sp.visible = true;		}				private function loadingData():void {			preloaderON();			city_staticField.visible = false;			woeid_staticField.visible = false;		}				private function loadingDataComplete():void {			preloaderOFF();			city_staticField.visible = true;			woeid_staticField.visible = true;			lookForCity_inputField.resetInput();		}				// ADAPT LAYOUT		protected override function adaptLayout(ev:Event = null):void 		{			var top = Main(root).topBar_sp.height;						//scale			scale = Math.max(stage.stageWidth,stage.stageHeight)/800;						city_staticField.scaleX = scale;			city_staticField.scaleY = scale;			woeid_staticField.scaleX = scale;			woeid_staticField.scaleY = scale;			lookForCity_inputField.scaleX = scale;			lookForCity_inputField.scaleY = scale;			cercar_bt.scaleX = scale;			cercar_bt.scaleY = scale;			guardar_bt.scaleX = scale;			guardar_bt.scaleY = scale;			cancelar_bt.scaleX = scale;			cancelar_bt.scaleY = scale;			preloader_sp.scaleX = scale;			preloader_sp.scaleY = scale;						background_sp.width = stage.stageWidth;			background_sp.height = stage.stageHeight;						// two different layouts: portrait and landscape			if(stage.stageWidth > stage.stageHeight){								//Landscape mode				trace("LANDSCAPE PREF");								city_staticField.x = stage.stageWidth/2 - city_staticField.width - MARGIN*scale/2;				woeid_staticField.x = stage.stageWidth/2 + MARGIN*scale/2;				city_staticField.y = top + 3*MARGIN*scale;				woeid_staticField.y = top + 3*MARGIN*scale;								lookForCity_inputField.x = stage.stageWidth/2 - lookForCity_inputField.width/2;				lookForCity_inputField.y = stage.stageHeight/2 - lookForCity_inputField.height/2;				cercar_bt.x = stage.stageWidth/2 - cercar_bt.width/2;				cercar_bt.y = lookForCity_inputField.y + lookForCity_inputField.height + MARGIN*scale/2;								cancelar_bt.x = woeid_staticField.x ;				guardar_bt.x = cancelar_bt.x - cancelar_bt.width - MARGIN*scale;				cancelar_bt.y =  stage.stageHeight - cancelar_bt.height - MARGIN*scale;				guardar_bt.y = cancelar_bt.y;								preloader_sp.x = stage.stageWidth/2; //preloader is centerd on (0,0)				preloader_sp.y = city_staticField.y + city_staticField.height/2;			}			else			{				//Portrait mode				trace("PORTRAIT PREF");								city_staticField.x = stage.stageWidth/2 - city_staticField.width/2;				woeid_staticField.x = city_staticField.x;								city_staticField.y = top + 3*MARGIN*scale;				woeid_staticField.y = city_staticField.y + city_staticField.height + MARGIN*scale/2;								lookForCity_inputField.x = stage.stageWidth/2 - lookForCity_inputField.width/2;				lookForCity_inputField.y = stage.stageHeight/2 - lookForCity_inputField.height/2;				cercar_bt.y = lookForCity_inputField.y + lookForCity_inputField.height + MARGIN*scale/2;												guardar_bt.x = stage.stageWidth/2 - guardar_bt.width/2;				cancelar_bt.x = guardar_bt.x;				cercar_bt.x = guardar_bt.x;								cancelar_bt.y =  stage.stageHeight - cancelar_bt.height - MARGIN*scale;				guardar_bt.y = cancelar_bt.y - guardar_bt.height - MARGIN*scale/2;								preloader_sp.x = stage.stageWidth/2; //preloader is centerd on (0,0)				preloader_sp.y = city_staticField.y + city_staticField.height + MARGIN*scale/4;			}					}	}}